{% extends "base.html" %}
{% block content %}
<div class="panel">
  <h2>Landowner Dashboard â€” {{ landowner.name or landowner.username }}</h2>
  <a href="{{ url_for('logout') }}" class="logout">Logout</a>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="toast-container">
      {% for category, msg in messages %}
        <div class="toast {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="form-panel">
  <h3>Create Booking</h3>
  <form method="POST">
    <label>Service Date</label>
    <input type="date" name="service_date" required>

    <label>Days</label>
    <input type="number" name="days" min="1" required>

    <label>Service Type</label>
    <select name="service_type" id="stype" onchange="toggleInputs()" required>
      <option value="">Select</option>
      <option value="labor">Labor</option>
      <option value="machinery">Machinery</option>
      <option value="both">Both</option>
    </select>

    <div id="labor-sec" style="display:none;">
      <label>Number of Labors</label>
      <input type="number" name="num_labor" min="1">
    </div>

    <div id="mach-sec" style="display:none;">
      <label>Machine Type</label>
      <input name="machine_type">
    </div>

    <button type="submit" class="btn">Create</button>
  </form>
</div>

<h3>My Bookings</h3>
<table>
  <thead>
    <tr>
      <th>ID</th><th>Date</th><th>Days</th><th>Type</th>
      <th>Labor Status</th><th>Machinery Status</th><th>Action</th>
    </tr>
  </thead>
  <tbody>
  {% for b in bookings %}
    <tr>
      <td>{{ b.id }}</td>
      <td>{{ b.service_date }}</td>
      <td>{{ b.days }}</td>
      <td>{{ b.service_type }}</td>
      <td>
        {{ b.labor_status }}
        {% if b.accepted_lab_names %}
          <div><small>Laborers: {{ ", ".join(b.accepted_lab_names) }}</small></div>
        {% endif %}
      </td>
      <td>
        {{ b.machinery_status }}
        {% if b.accepted_mach_names %}
          <div><small>Machinery: {{ ", ".join(b.accepted_mach_names) }}</small></div>
        {% endif %}
      </td>
      <td>{{ b.action }}</td>
    </tr>
  {% else %}
    <tr><td colspan="7">No bookings</td></tr>
  {% endfor %}
</tbody>

</table>

<script>
function toggleInputs() {
  let type = document.getElementById('stype').value;
  document.getElementById('labor-sec').style.display = (type === 'labor' || type === 'both') ? 'block' : 'none';
  document.getElementById('mach-sec').style.display = (type === 'machinery' || type === 'both') ? 'block' : 'none';
}
</script>
{% endblock %}
